{% load static %}
<!DOCTYPE html>
<html lang="es">
<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<!--<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script> quito el error de fn-->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<head>

    <title>Linda Sonrisa - Perfil</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="{% static 'base/images/favicon.ico' %}" type="image/x-icon">
    <link rel="icon" href="{% static 'base/images/favicon.ico' %}" type="image/x-icon">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'base/css/open-iconic-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/animate.css' %}">

    <link rel="stylesheet" href="{% static 'base/css/owl.carousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/owl.theme.default.min.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/magnific-popup.css' %}">
    <link rel="stylesheet" href="{% static 'base/js/jqwidgets/styles/jqx.base.css' %}" type="text/css"/>
    <link rel="stylesheet" href="{% static 'base/css/aos.css' %}">

    <link rel="stylesheet" href="{% static 'base/css/ionicons.min.css' %}">

    <link rel="stylesheet" href="{% static 'base/css/bootstrap-datepicker.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/jquery.timepicker.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/flaticon.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/icomoon.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/propio.css' %}">
    <link rel="stylesheet" href="{% static 'base/perfil/css/perfil.css' %}">
    <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css'>
    <link rel="stylesheet" href="{% static 'base/js/jqwidgets/styles/jqx.material.css' %}" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>


<body>

<nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
    <div class="container">
        <a href="{% url 'generales:home' %}"><img alt="logo" id="logo"
                                                  src="{% static 'base/images/logo.jpg' %}"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
                aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation" id="text-nav">
            <span class="oi oi-menu" id="text-nav"></span> Menú
        </button>

        <div class="collapse navbar-collapse" id="ftco-nav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item" id="hovermenu"><a href="{% url 'generales:home' %}" class="nav-link">Inicio</a>
                </li>
                <li class="nav-item" id="hovermenu"><a href="{% url 'generales:nosotros' %}"
                                                       class="nav-link">Nosotros</a></li>
                <li class="nav-item" id="hovermenu"><a href="{% url 'generales:convenios' %}"
                                                       class="nav-link">Convenios & Promociones</a></li>
                <li class="nav-item" id="hovermenu"><a href="{% url 'generales:contacto' %}"
                                                       class="nav-link">Contacto</a></li>
                <li class="nav-item" id="hovermenu"><a href="{% url 'generales:servicios' %}"
                                                       class="nav-link">Servicios</a></li>
                <li class="nav-item" id="hovermenu"><a href="{% url 'generales:proceso_reserva' %}"
                                                       class="nav-link">Reserva</a></li>
                <li class="nav-item" id="hovermenu"><a href="{% url 'generales:logout' %}" class="nav-link">Cerrar
                    sesión</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="card">

                <div class="card-body">
                    <div class="card-title mb-4">
                        <div class="d-flex justify-content-start">

                            <div class="image-container">
                                <img src="{{ user.usuario.ruta_foto.url }}" id="imgProfile"
                                     style="width: 150px; height: 150px" class="img-thumbnail" alt="foto perfil"/>

                            </div>

                            <div class="userData ml-3">
                                <h2 class="d-block"
                                    id="nombreperfil">{{ user.usuario.nombre }} {{ user.usuario.ap_paterno }} {{ user.usuario.ap_materno }}</h2>
                            </div>
                            <div class="ml-auto">
                                <input type="button" class="btn btn-primary d-none" id="btnDiscard"
                                       value="Deshacer cambios"/>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="infoPersonal-tab" data-toggle="tab"
                                       href="#infoPersonal" role="tab" aria-controls="infoPersonal"
                                       aria-selected="true">Información Personal</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="infoCuenta-tab" data-toggle="tab" href="#infoCuenta"
                                       role="tab" aria-controls="infoCuenta" aria-selected="false">Información
                                        Cuenta</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="documentos-tab" data-toggle="tab" href="#documentos"
                                       role="tab" aria-controls="documentos" aria-selected="false">Documentos</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="misReservas-tab" data-toggle="tab" href="#misReservas"
                                       role="tab" aria-controls="misReservas" aria-selected="false">Mis
                                        reservas</a>
                                </li>
                            </ul>
                            <div class="tab-content ml-1" id="myTabContent">
                                <div class="tab-pane fade show active" id="infoPersonal" role="tabpanel"
                                     aria-labelledby="infoPersonal-tab">
                                    <small id="small">(Este RUT será utilizado
                                        para ingresar a la cuenta)</small>
                                    <div class="row">
                                        <div class="col-sm-3 col-md-2 col-5">
                                            <label style="font-weight:bold;">RUT</label>
                                        </div>
                                        <div class="col-md-8 col-6">
                                            <input type="text" class="form-control" name="rut" id="rut"
                                                   alt="rut" value="{{ user.get_username }}" disabled>
                                        </div>
                                    </div>
                                    <hr/>

                                    <div class="row">
                                        <div class="col-sm-3 col-md-2 col-5">
                                            <label style="font-weight:bold;">Fecha de nacimiento</label>
                                        </div>
                                        <div class="col-md-8 col-6">
                                            <input type="text" class="form-control" name="fecha_nacimiento"
                                                   id="fecha_nacimiento" value="{{ user.usuario.fecha_nacimiento }}"
                                                   disabled>
                                        </div>
                                    </div>
                                    <hr/>
                                    <form class="form" action="" method="POST" enctype="multipart/form-data"
                                          data-url="postPersonal/" id="infoPersonalForm">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Foto perfil</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <input type="button" class="btn btn-secondary" id="btnChangePicture"
                                                       value="Cambiar"/>
                                                <input type="file" style="display: none;" id="profilePicture"
                                                       name="ruta_foto" onchange="validarFoto()"
                                                       accept="image/x-png,image/gif,image/jpeg"/>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Género</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <div class="form-control" name="genero_id" id="genero"></div>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Número móvil</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <input type="text" class="form-control" name="fono_movil"
                                                       id="numMovil" value="{{ user.usuario.fono_movil }}"
                                                       max="99999999"
                                                       maxlength="8">
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Número fijo</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <input type="text" class="form-control" name="fono_fijo"
                                                       id="numFijo" value="{{ user.usuario.fono_fijo }}" max="99999999"
                                                       maxlength="8">
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Región</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <div class="form-control" name="region_id" id="region"></div>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Comuna</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <div class="form-control" name="comuna_id" id="comuna"></div>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Dirección</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <input type="text" class="form-control" name="direccion"
                                                       id="direccion" value="{{ user.usuario.direccion }}">
                                            </div>
                                        </div>
                                        <hr/>
                                        <div id="carga-personal" style="display:none;">
                                            <!-- div para cargar un loader -->
                                            <div class="form-group d-flex">
                                                <img alt="load perfil" src="{% static 'base/images/load-perfil.gif' %}">
                                                <p> Guardando...</p>
                                            </div>

                                        </div>
                                        <div id="mensaje_personal" style="display:none;">
                                        </div>
                                        <input type="submit" class="btn btn-primary py-3 px-5"
                                               onclick="validarPersonal()" value="Guardar" id="guardarPersonal">
                                        <button class="btn btn-lg" type="reset" name="reset" id="reset"><i
                                                class="glyphicon glyphicon-repeat"></i>
                                            Reiniciar
                                        </button>

                                        <br><br>
                                        <div class="alert alert-danger" role="alert" id="alertPersonal">
                                            Por favor, todos los datos son obligatorios.
                                            <p id="p_genero">- Error al seleccionar género.</p>
                                            <p id="p_movil">- Error al ingresar número móvil. El formato debe ser 8
                                                números.</p>
                                            <p id="p_fijo">- Error al ingresar número fijo. El formato debe ser 8
                                                números.</p>
                                            <p id="p_region">- Error al seleccionar una región.</p>
                                            <p id="p_comuna">- Error al seleccionar una comuna.</p>
                                            <p id="p_direccion">- Error al ingresar la dirección.</p>
                                        </div>
                                    </form>
                                </div>
                                <div class="tab-pane fade" id="infoCuenta" role="tabpanel"
                                     aria-labelledby="infoCuenta-tab">
                                    <label>Si desea cambiar las contraseñas dirígase a este enlace: <a
                                            id="recuperarcontrasena"
                                            href="{% url 'generales:password_reset' %}">Cambiar
                                        contraseña</a></label>
                                    <form class="form" data-url="postCorreo/" method="POST" id="infoCuentaForm">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Correo electrónico</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <input type="email" class="form-control" name="correo" id="correo"
                                                       value="{{ request.user.email }}">
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Última conexión</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <label>Última conexión: {{ request.user.last_login }}</label>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Cuenta creada</label>
                                            </div>
                                            <div class="col-md-8 col-6">
                                                <label>Cuenta creada: {{ request.user.date_joined }}</label>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div id="carga-correo" style="display:none;">
                                            <!-- div para cargar un loader -->
                                            <div class="form-group d-flex">
                                                <img src="{% static 'base/images/load-perfil.gif' %}" alt="carga">
                                                <p> Guardando...</p>
                                            </div>

                                        </div>
                                        <div id="mensaje_correo" style="display:none;">
                                        </div>
                                        <input type="submit" class="btn btn-primary py-3 px-5"
                                               onclick="validarCuenta()" value="Guardar" id="guardarCorreo">
                                        <button class="btn btn-lg" type="reset"><i
                                                class="glyphicon glyphicon-repeat"></i>
                                            Reiniciar
                                        </button>
                                        <br><br>
                                        <div class="alert alert-danger" role="alert" id="alertCuenta">
                                            Por favor, todos los datos son obligatorios.
                                            <p id="p_correo">- Error al ingresar el correo. Asegúrese de ingresar
                                                formato
                                                válido.</p>
                                            <p id="p_existente">- Error al ingresar el correo. Este correo ya
                                                existe.</p>
                                        </div>
                                    </form>
                                </div>
                                <div class="tab-pane fade" id="documentos" role="tabpanel"
                                     aria-labelledby="documentos-tab">
                                    <form class="form" method="POST" enctype="multipart/form-data"
                                          data-url="postDocumentos/"
                                          id="formDocumentos">
                                        {% csrf_token %}
                                        <small id="small">Solo se admiten documentos con extensión PDF.</small>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Certificado AFP</label>
                                            </div>
                                            <div class="col-md-8 col-6" id="divFile">
                                                <input type="file" class="form-control" id="afp"
                                                       onchange="Filevalidation(id)" accept="application/pdf"
                                                       name='afp'>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Certificado de
                                                    liquidaciones</label>
                                            </div>
                                            <div class="col-md-8 col-6" id="divFile">
                                                <input type="file" class="form-control" id="liquidaciones"
                                                       onchange="Filevalidation(id)" accept="application/pdf"
                                                       name='liquidacion'>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Certificado de
                                                    finiquitos</label>
                                            </div>
                                            <div class="col-md-8 col-6" id="divFile">
                                                <input type="file" class="form-control" id="finiquitos"
                                                       onchange="Filevalidation(id)" accept="application/pdf"
                                                       name='finiquito'>
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Certificado FONASA o
                                                    ISAPRE</label>
                                            </div>
                                            <div class="col-md-8 col-6" id="divFile">
                                                <input type="file" class="form-control" name="salud" id="salud"
                                                       onchange="Filevalidation(id)" accept="application/pdf">
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="row" id="rowPasaporte">
                                            <div class="col-sm-3 col-md-2 col-5">
                                                <label style="font-weight:bold;">Certificado de Pasaporte <small
                                                        id="small">
                                                    (solo si es extranjero)</small></label>
                                            </div>
                                            <div class="col-md-8 col-6" id="divFile">
                                                <input type="file" class="form-control" name="pasaporte"
                                                       id="pasaporte" onchange="Filevalidation(id)"
                                                       accept="application/pdf">
                                            </div>
                                        </div>
                                        <hr/>
                                        <div class="alert alert-danger" role="alert" id="alertDocumentos">
                                            <p id="p_afp">- Error al subir AFP. El archivo debe pesar más de 30
                                                kb y
                                                menos de 2 mb y en formato PDF.</p>
                                            <p id="p_liquidaciones">- Error al subir liquidaciones. El archivo
                                                debe
                                                pesar más de 30 kb y menos de 2 mb y en formato PDF.</p>
                                            <p id="p_finiquitos">- Error al subir finiquitos. El archivo debe
                                                pesar
                                                más de 30 kb y menos de 2 mb y en formato PDF.</p>
                                            <p id="p_salud">- Error al subir certificado de salud. El archivo
                                                debe
                                                pesar más de 30 kb y menos de 2 mb y en formato PDF.</p>
                                            <p id="p_pasaporte">- Error al subir pasaporte. El archivo debe
                                                pesar
                                                más de 30 kb y menos de 2 mb y en formato PDF.</p>
                                        </div>
                                        <table role="table" id="tablaDocumentos">
                                            <thead role="rowgroup">
                                            <tr role="row">
                                                <th role="columnheader">Documento</th>
                                                <th role="columnheader">Ver / Descargar</th>
                                            </tr>
                                            </thead>
                                        </table>
                                        <br>
                                        <div id="carga-documentos" style="display:none;">
                                            <!-- div para cargar un loader -->
                                            <div class="form-group d-flex">
                                                <img alt="carga-documentos"
                                                     src="{% static 'base/images/load-perfil.gif' %}">
                                                <p> Guardando...</p>
                                            </div>

                                        </div>
                                        <div id="mensaje_documentos" style="display:none;">
                                        </div>
                                        <input type="submit" class="btn btn-primary py-3 px-5"
                                               value="Guardar" id="guardarDocumentos">
                                    </form>
                                </div>
                                <div class="tab-pane fade" id="misReservas" role="tabpanel"
                                     aria-labelledby="misReservas-tab">
                                    <label>En esta sección usted podrá modificar sus reservas o anularlas.</label>
                                    <table role="table" id="tablaReservas">
                                        <thead role="rowgroup">
                                        <tr role="row">
                                            <th role="columnheader">Código</th>
                                            <th role="columnheader">Servicio</th>
                                            <th role="columnheader">Médico</th>
                                            <th role="columnheader">Fecha reserva</th>
                                            <th role="columnheader">Hora</th>
                                            <th role="columnheader">Box</th>
                                        </tr>
                                        </thead>
                                    </table>
                                    <br>
                                    <p style="font-weight:bold;">Anular reserva</p>
                                    <p>Para anular una reserva debes ingresar el código de reserva.</p>
                                    <form class="form" data-url="anularReserva/" method="POST" id="anularForm">
                                        {% csrf_token %}
                                        <div id="carga-anular" style="display:none;">
                                            <!-- div para cargar un loader -->
                                            <div class="form-group d-flex">
                                                <img alt="carga-anular"
                                                     src="{% static 'base/images/load-perfil.gif' %}">
                                                <p> Anulando...</p>
                                            </div>

                                        </div>
                                        <div id="mensaje_anular" style="display:none;">
                                        </div>
                                        <input type="number" name="codigo_reserva"
                                               placeholder="Código de reserva. Ej: 1">
                                        <input type="submit" value="Anular" id="anularReserva" class="btn btn-danger">
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>

            </div>
        </div>
    </div>
</div>


</body>
<script src="{% static 'base/perfil/js/perfil.js' %}"></script>

<!-- carga -->
<script src="{% static 'base/js/jquery-migrate-3.0.1.min.js' %}"></script>
<script src="{% static 'base/js/jquery.stellar.min.js' %}"></script>
<script src="{% static 'base/js/aos.js' %}"></script>
<script src="{% static 'base/js/main.js' %}"></script>
<!-- carga -->
<script src="{% static 'base/js/propio.js' %}"></script>
<script type="text/javascript" src="{% static 'base/js/scripts/jquery-1.11.1.min.js' %}"></script>

<script type="text/javascript" src="{% static 'base/js/jqwidgets/jqxcore.js' %}"></script>
<script type="text/javascript" src="{% static 'base/js/jqwidgets/jqxinput.js' %}"></script>
<script type="text/javascript" src="{% static 'base/js/jqwidgets/jqxbuttons.js' %}"></script>
<script type="text/javascript" src="{% static 'base/js/jqwidgets/jqxscrollbar.js' %}"></script>
<script type="text/javascript" src="{% static 'base/js/jqwidgets/jqxlistbox.js' %}"></script>
<script type="text/javascript" src="{% static 'base/js/jqwidgets/jqxcombobox.js' %}"></script>

</html>